{
  "version": 3,
  "file": "common-ecc.js",
  "sourceRoot": "",
  "sources": [
    "coffeescripts/common-ecc.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "crypto = require \"crypto\"\necKeyUtils = require \"eckey-utils\"\nbase64 = require \"./base64\"\ncommon = require \"./common\"\nksuid = require \"./ksuid\"\n\n###*\n * Generate a key identifier suitable for use as a `kid` in a JSON Web Key.\n *\n * @param {Object} jwk - The JSON Web Key for which a `kid` is going to be generated.\n * @returns {string} The key identifier.\n###\ngenerateKeyIdentifier = (jwk) =>\n  new Promise (resolve, reject) =>\n    if jwk?.publicKey?.x?\n      buffer = Buffer.from(await base64.urlDecode(jwk.publicKey.x))\n      resolve buffer.slice(0, 4).toString(\"hex\")\n    else\n      reject new Error \"Invalid JSON Web Key supplied.\"\n\nmodule.exports =\n  ###*\n   * Convert a PEM certificate to a JSON Web Key.\n   *\n   * @param {string} curveName - The type of ECC curve.\n   * @param {string|Buffer} privateOrPublicPem - The private or public PEM key.\n   * @param {Array} privateKeyOps - The operations intended for the private key.\n   * @param {Array} publicKeyOps - The operations intended for the public key.\n   * @returns {Object} The converted certificate.\n  ###\n  convertPemToJwk: (curveName, privateOrPublicPem, privateKeyOps = [], publicKeyOps = []) =>\n    new Promise (resolve, reject) =>\n      if privateKeyOps.length is 0\n        privateKeyOps = [\"deriveKey\", \"sign\"]\n\n      if publicKeyOps.length is 0\n        publicKeyOps = [\"verify\"]\n\n      try\n        parsed = ecKeyUtils.parsePem(privateOrPublicPem)\n        params = {}\n\n        if parsed.privateKey isnt undefined and parsed.privateKey isnt null\n          params.privateKey = parsed.privateKey\n\n        if parsed.publicKey isnt undefined and parsed.publicKey isnt null\n          params.publicKey = parsed.publicKey\n\n        jwk = ecKeyUtils.generateJwk(curveName, parsed)\n        kid = await generateKeyIdentifier(jwk)\n\n        if jwk.privateKey isnt undefined\n          jwk.privateKey.kid = kid\n          jwk.privateKey.key_ops = privateKeyOps\n\n        if jwk.publicKey isnt undefined\n          jwk.publicKey.kid = kid\n          jwk.publicKey.key_ops = publicKeyOps\n\n        resolve jwk\n      catch err\n        reject err\n\n  ###*\n   * Convert a JSON Web Key to a PEM certificate.\n   *\n   * @param {string} curveName - The type of ECC curve.\n   * @param {string|Buffer} privateOrPublicJwk - The private or public JSON Web Key.\n   * @returns {Object} The converted certificate.\n  ###\n  convertJwkToPem: (curveName, privateOrPublicJwk) =>\n    new Promise (resolve, reject) =>\n      try\n        parsed = ecKeyUtils.parseJwk(privateOrPublicJwk)\n        params = {}\n\n        if parsed.privateKey isnt undefined and parsed.privateKey isnt null\n          params.privateKey = parsed.privateKey\n\n        if parsed.publicKey isnt undefined and parsed.publicKey isnt null\n          params.publicKey = parsed.publicKey\n\n        resolve ecKeyUtils.generatePem(curveName, params)\n      catch err\n        reject err\n\n  ###*\n   * Generate an ECDH key pair as a JSON Web Key.\n   *\n   * @param {string} curveName - The type of ECC curve.\n   * @param {Array} privateKeyOps - The operations intended for the private key.\n   * @param {Array} publicKeyOps - The operations intended for the public key.\n   * @returns {string} The ECDH key pair.\n  ###\n  generateJwkKeyPair: (curveName, privateKeyOps = [], publicKeyOps = []) =>\n    if privateKeyOps.length is 0\n      privateKeyOps = [\"deriveKey\", \"sign\"]\n\n    if publicKeyOps.length is 0\n      publicKeyOps = [\"verify\"]\n\n    new Promise (resolve, reject) =>\n      ecdh = crypto.createECDH curveName\n      ecdh.generateKeys()\n      params =\n        privateKey: ecdh.getPrivateKey()\n        publicKey: ecdh.getPublicKey()\n\n      jwk = ecKeyUtils.generateJwk curveName, params\n      kid = await generateKeyIdentifier(jwk)\n\n      jwk.privateKey.kid = kid\n      jwk.privateKey.key_ops = privateKeyOps\n\n      jwk.publicKey.kid = kid\n      jwk.publicKey.key_ops = publicKeyOps\n\n      resolve jwk\n\n  ###*\n   * Generate an ECDH key pair as PEM certificates.\n   *\n   * @param {string} curveName - The type of ECC curve.\n   * @returns {Object} The PEM certificates.\n  ###\n  generatePemKeyPair: (curveName) =>\n    new Promise (resolve, reject) =>\n      ecdh = crypto.createECDH curveName\n      ecdh.generateKeys()\n      params =\n        privateKey: ecdh.getPrivateKey()\n        publicKey: ecdh.getPublicKey()\n\n      resolve ecKeyUtils.generatePem curveName, params\n\n  ###*\n   * Sign a payload to prevent it from tamper.\n   *\n   * @param {string} payload - The payload to sign.\n   * @param {string} privateKeyPem - The private key in PEM format.\n   * @param {string} hashType - The type of SHA2 digest to use. Defaults to SHA-256.\n   * @returns {Buffer} The signature for the payload.\n  ###\n  signPayload: (payload, privateKeyPem, hashType = \"sha256\") =>\n    new Promise (resolve, reject) =>\n      if typeof payload isnt \"string\"\n        return reject \"Payload must be a string.\"\n\n      signer = crypto.createSign hashType\n      message = Buffer.from payload\n      signer.update message\n      resolve signer.sign privateKeyPem\n\n  ###*\n   * Verify the signature of a given payload.\n   *\n   * @param {string} payload - The payload against which the signature will be checked.\n   * @param {string|Buffer} signature - The signature of the payload.\n   * @param {Object} publicPemKey - The public ECDH key in PEM format.\n   * @param {string} hashType - The type of SHA2 digest to use. Defaults to SHA-256.\n   * @returns {boolean}\n  ###\n  verifyPayloadSignature: (payload, signature, publicKeyPem, hashType = \"sha256\") =>\n    new Promise (resolve, reject) =>\n      if typeof payload isnt \"string\"\n        return reject \"Payload must be a string.\"\n\n      verifier = crypto.createVerify hashType\n      message = Buffer.from payload\n      verifier.update message\n      resolve verifier.verify publicKeyPem, signature\n\n  ###*\n   * Compute an ECDH shared secret.\n   *\n   * @param {string} curveName - The type of ECC curve.\n   * @param {Object} privatePemKey - The private ECDH key in PEM format.\n   * @param {Object} otherPublicPemKey - The other public ECDH key in PEM format.\n   * @returns {Buffer}\n  ###\n  computeSecret: (curveName, privatePemKey, otherPublicPemKey) =>\n    new Promise (resolve, reject) =>\n      try\n        ecdh = crypto.createECDH curveName\n        ecdh.setPrivateKey (ecKeyUtils.parsePem(privatePemKey)).privateKey\n        resolve ecdh.computeSecret (ecKeyUtils.parsePem(otherPublicPemKey)).publicKey\n      catch err\n        reject err\n"
  ]
}